<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞—Ä–æ—á–Ω–æ–≥–æ –∑–∞ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Inter',sans-serif;background: radial-gradient(circle at 20% 20%, #1b2233 0%, #0b0e14 40%, #05070c 100%);color:#e9edf7;overflow-x:hidden;display:flex;flex-direction:row;}

/* –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ */
.menu{display:flex;flex-direction:column;width:60px;background:rgba(30,35,50,0.95);padding:20px 0;position:fixed;height:100vh;z-index:100;border-radius:0 12px 12px 0;box-shadow:2px 0 10px rgba(0,0,0,0.4);}
.menu button{background:none;border:none;color:#aaa;font-size:20px;margin:10px 0;cursor:pointer;display:flex;justify-content:center;align-items:center;transition:0.3s;}
.menu button.active{color:#fff;}
.menu button i{pointer-events:none;}

/* –°–¢–†–ê–ù–ò–¶–´ */
.page{display:none;padding:20px;padding-left:80px;flex:1;}
.page.active{display:block;}

/* REVIEW CONTAINER */
.review-container{max-width:1000px;width:100%;margin:auto;padding:25px;background:rgba(18,22,30,0.85);backdrop-filter:blur(20px);border-radius:24px;box-shadow:0 0 60px rgba(0,0,0,0.7);transition: all 0.4s ease;}

/* TOP */
.top{display:flex;gap:20px;margin-bottom:25px;flex-wrap:wrap;}
.cover-wrapper{position:relative;cursor:pointer;}
.cover{width:180px;height:180px;border-radius:16px;background:linear-gradient(145deg,#1c2230,#11141b);object-fit:cover;box-shadow:0 0 20px rgba(0,0,0,0.6);transition:all 0.4s ease;}
.meta{flex:1;display:flex;flex-direction:column;gap:10px;}
.meta input{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);padding:10px;border-radius:12px;color:#fff;font-size:14px;}

/* –ß–ï–ö–ë–û–ö–°–´ */
.award-container{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:5px;}
.award{display:flex;align-items:center;gap:5px;font-size:12px;cursor:pointer;}
.award input{appearance:none;width:14px;height:14px;border-radius:50%;border:1px solid #555;background:#555;cursor:pointer;box-shadow:0 0 2px rgba(0,0,0,0.2);}
.award input:checked{background:#fff;box-shadow:0 0 6px #fff;}

/* –ë–õ–û–ö–ò */
.block{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);border-radius:18px;padding:15px;margin-bottom:12px;box-shadow:0 0 20px rgba(0,0,0,0.4);overflow-x:hidden;transition:all 0.4s ease;}
.block.vibe{background:linear-gradient(90deg, rgba(120,60,255,0.15), rgba(255,60,180,0.1));border:1px solid rgba(160,90,255,0.4);}
.label{display:flex;justify-content:space-between;margin-bottom:8px;font-weight:500;}

/* –°–õ–ê–ô–î–ï–†–´ */
input[type=range]{-webkit-appearance:none;width:100%;height:10px;border-radius:5px;background: rgba(255,255,255,0.2);outline:none;box-shadow:0 0 4px rgba(255,255,255,0.3);}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:#fff;box-shadow:0 0 8px #fff;cursor:pointer;}
input[type=range]::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:#fff;box-shadow:0 0 8px #fff;cursor:pointer;}

/* RESULT */
.result{text-align:right;margin-top:20px;font-size:48px;font-weight:700;}
.result .small{font-size:18px;opacity:0.4;}

/* TEXTAREA */
textarea{width:100%;margin-top:15px;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.04);color:#fff;min-height:120px;resize:none;overflow:auto;}

/* BUTTONS */
.save-btn{margin-top:15px;padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;color:#fff;font-weight:600;cursor:pointer;transition:0.3s;}
.save-btn:hover{background:rgba(255,255,255,0.1);}
#editBtn,#deleteBtn{margin-top:15px;padding:10px 16px;border:none;border-radius:12px;font-weight:600;cursor:pointer;transition:0.3s;}
#editBtn{background:rgba(100,150,255,0.2);color:#fff;}
#editBtn:hover{background:rgba(100,150,255,0.3);}
#deleteBtn{background:rgba(255,50,50,0.2);color:#fff;margin-left:8px;}
#deleteBtn:hover{background:rgba(255,50,50,0.3);}

/* –ö–ê–†–¢–û–ß–ö–ò */
.card{background:rgba(18,22,30,0.85);border-radius:16px;padding:10px 12px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.05);display:flex;align-items:center;gap:10px;cursor:pointer;transition:all 0.3s ease;}
.card:hover{transform:scale(1.02);}
.card .rank{width:20px;text-align:center;font-weight:700;color:#fff;}
.card img{width:40px;height:40px;border-radius:6px;object-fit:cover;}
.card .title{font-weight:700;flex:1;font-size:14px;}
.card .score{font-size:16px;font-weight:600;margin-left:8px;}
.card .badges{display:flex;gap:4px;margin-left:5px;}
.card .badges span{background:rgba(100,150,255,0.2);color:#fff;font-size:10px;font-weight:600;padding:2px 5px;border-radius:6px;}

/* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û */
#previewModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:200;opacity:0;pointer-events:none;transition:opacity 0.3s;}
#previewModal.show{opacity:1;pointer-events:auto;}
#previewInner{background: rgba(18,22,30,0.95);padding:20px;border-radius:20px;max-width:90%;width:90%;max-height:90vh;overflow-y:auto;display:flex;flex-direction:column;gap:15px;box-shadow:0 0 40px rgba(0,0,0,0.7);transform:scale(0.8);transition:all 0.3s ease;}
#previewModal.show #previewInner{transform:scale(1);}
#previewInner .review-container{width:100%;position:relative;}
#previewInner .author-info{display:flex;align-items:center;gap:5px;font-size:12px;margin-top:5px;}

/* –ö–∞—Å—Ç–æ–º–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è */
#confirmModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:300;opacity:0;pointer-events:none;transition:opacity 0.3s;}
#confirmModal.show{opacity:1;pointer-events:auto;}
#confirmInner{background:rgba(30,35,50,0.95);padding:25px;border-radius:24px;max-width:400px;width:90%;text-align:center;box-shadow:0 0 40px rgba(0,0,0,0.7);}
#confirmInner p{margin-bottom:20px;font-size:16px;}
#confirmInner button{padding:10px 20px;border:none;border-radius:12px;margin:0 10px;font-weight:600;cursor:pointer;transition:0.3s;}
#confirmYes{background:rgba(255,50,50,0.2);color:#fff;}
#confirmYes:hover{background:rgba(255,50,50,0.3);}
#confirmNo{background:rgba(100,150,255,0.2);color:#fff;}
#confirmNo:hover{background:rgba(100,150,255,0.3);}

/* –ü–†–û–§–ò–õ–¨ */
.profile-container{max-width:600px;width:100%;margin:auto;padding:20px;background:rgba(18,22,30,0.85);border-radius:20px;box-shadow:0 0 40px rgba(0,0,0,0.7);display:flex;flex-direction:column;gap:12px;position:relative;align-items:center;}
#profileAvatar{width:100px;height:100px;border-radius:50%;background:linear-gradient(145deg,#1c2230,#11141b);object-fit:cover;cursor:pointer;box-shadow:0 0 20px rgba(0,0,0,0.6);}
#welcomeMsg{margin-top:8px;font-size:14px;opacity:0.7;text-align:center;}
#loginBtn,#logoutBtn{padding:10px 16px;border:none;border-radius:12px;background:rgba(100,150,255,0.2);color:#fff;font-weight:600;cursor:pointer;transition:0.3s;}
#loginBtn:hover,#logoutBtn:hover{background:rgba(100,150,255,0.3);}

/* –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø */
#authModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:400;opacity:0;pointer-events:none;transition:opacity 0.3s;}
#authModal.show{opacity:1;pointer-events:auto;}
#authInner{background:rgba(18,22,30,0.95);padding:25px;border-radius:24px;max-width:400px;width:90%;display:flex;flex-direction:column;gap:15px;box-shadow:0 0 40px rgba(0,0,0,0.7);}
.auth-tabs{display:flex;gap:10px;justify-content:center;margin-bottom:10px;}
.auth-tabs button{flex:1;padding:10px 0;border:none;border-radius:12px;background:rgba(100,150,255,0.2);color:#fff;font-weight:600;cursor:pointer;transition:0.3s;}
.auth-tabs button.active{background:rgba(100,150,255,0.3);}
.auth-tabs button:hover{background:rgba(100,150,255,0.3);}
.auth-content{display:flex;flex-direction:column;gap:12px;}
.auth-avatar{width:80px;height:80px;border-radius:50%;background:linear-gradient(145deg,#1c2230,#11141b);margin:0 auto;cursor:pointer;object-fit:cover;box-shadow:0 0 10px rgba(0,0,0,0.5);}
.auth-content input{padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.04);color:#fff;outline:none;}
.auth-submit{padding:10px;border:none;border-radius:12px;background:rgba(100,150,255,0.2);color:#fff;font-weight:600;cursor:pointer;transition:0.3s;}
.auth-submit:hover{background:rgba(100,150,255,0.3);}

/* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
@media(max-width:480px){
  .cover{width:140px;height:140px;}
  .review-container{padding:15px;}
  .block{padding:12px;}
  .result{font-size:36px;}
  .card .title{font-size:12px;}
  .card .score{font-size:14px;}
}
.version-label{position:fixed;bottom:5px;right:10px;font-size:12px;opacity:0.5;}
</style>
</head>
<body>

<div class="menu">
  <button class="active" onclick="openPage('home',event)"><i class="fa-solid fa-house"></i></button>
  <button onclick="openPage('review',event)"><i class="fa-solid fa-star"></i></button>
  <button onclick="openPage('profile',event)"><i class="fa-solid fa-user"></i></button>
</div>

<div id="home" class="page active"></div>

<div id="review" class="page">
  <div class="review-container">
    <div class="top">
      <div class="cover-wrapper" onclick="coverInput.click()">
        <img id="coverPreview" class="cover">
        <input type="file" id="coverInput" hidden>
      </div>
      <div class="meta">
        <input type="text" id="artist" placeholder="–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å">
        <input type="text" id="album" placeholder="–ê–ª—å–±–æ–º">
        <div class="award-container">
          <label class="award"><input type="checkbox" id="a1"> üñº –û–±–ª–æ–∂–∫–∞ –º–µ—Å—è—Ü–∞</label>
          <label class="award"><input type="checkbox" id="a2"> üíø –ê–ª—å–±–æ–º –º–µ—Å—è—Ü–∞</label>
          <label class="award"><input type="checkbox" id="a3"> üé¨ –ö–ª–∏–ø –º–µ—Å—è—Ü–∞</label>
          <label class="award"><input type="checkbox" id="a4"> üèÜ –ê–ª—å–±–æ–º –≥–æ–¥–∞</label>
        </div>
      </div>
    </div>
    <div class="block"><div class="label">–†–∏—Ñ–º—ã / –û–±—Ä–∞–∑—ã <span id="v1">5</span></div><input type="range" min="1" max="10" value="5" id="s1"></div>
    <div class="block"><div class="label">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ / –†–∏—Ç–º–∏–∫–∞ <span id="v2">5</span></div><input type="range" min="1" max="10" value="5" id="s2"></div>
    <div class="block"><div class="label">–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∏–ª—è <span id="v3">5</span></div><input type="range" min="1" max="10" value="5" id="s3"></div>
    <div class="block"><div class="label">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç—å / –•–∞—Ä–∏–∑–º–∞ <span id="v4">5</span></div><input type="range" min="1" max="10" value="5" id="s4"></div>
    <div class="block vibe"><div class="label">–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ / –í–∞–π–± <span id="v5">5</span></div><input type="range" min="1" max="10" value="5" id="s5"></div>
    <div class="result"><span id="total">28</span><span class="small"> / 90</span></div>
    <textarea id="text" placeholder="–¢–µ–∫—Å—Ç —Ä–µ—Ü–µ–Ω–∑–∏–∏"></textarea>
    <button class="save-btn" onclick="saveReview()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é</button>
  </div>
</div>

<div id="profile" class="page">
  <div class="profile-container">
    <img id="profileAvatar" src="" alt="–ê–≤–∞—Ç–∞—Ä">
    <div id="welcomeMsg"></div>
    <button id="loginBtn">–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    <button id="logoutBtn" style="display:none;" onclick="logout()">–í—ã–π—Ç–∏</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∏ -->
<div id="previewModal">
  <div id="previewInner">
    <div class="review-container" id="previewContent"></div>
    <div class="author-info" id="previewAuthor"></div>
    <div style="display:flex;justify-content:center;">
      <button id="editBtn">–ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é</button>
      <button id="deleteBtn">–£–¥–∞–ª–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é</button>
    </div>
  </div>
</div>

<div id="confirmModal">
  <div id="confirmInner">
    <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ä–µ—Ü–µ–Ω–∑–∏—é?</p>
    <button id="confirmYes">–î–∞, —É–¥–∞–ª–∏—Ç—å</button>
    <button id="confirmNo">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ 2.7 -->
<div id="authModal">
  <div id="authInner">
    <div class="auth-tabs">
      <button id="tabLogin" class="active">–í—Ö–æ–¥</button>
      <button id="tabRegister">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    </div>
    <div class="auth-content">
      <img id="authAvatar" class="auth-avatar" src="" style="display:none;">
      <input type="text" id="authUsername" placeholder="–ù–∏–∫">
      <input type="password" id="authPassword" placeholder="–ü–∞—Ä–æ–ª—å">
      <input type="password" id="authPassword2" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="display:none;">
      <button id="authSubmit" class="auth-submit">–í–æ–π—Ç–∏</button>
    </div>
  </div>
</div>

<div class="version-label">2.7</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ---------- Firebase ----------
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "limteam-46e0f.firebaseapp.com",
  databaseURL: "https://limteam-46e0f-default-rtdb.firebaseio.com/",
  projectId: "limteam-46e0f",
  storageBucket: "limteam-46e0f.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ---------- Global ----------
let currentUser = localStorage.getItem("currentUser") || null;
let currentAvatar = localStorage.getItem("currentAvatar") || "";
let editingIndex = null;

// ---------- Profile ----------
const profileAvatar = document.getElementById("profileAvatar");
const welcomeMsg = document.getElementById("welcomeMsg");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");

if(currentUser){
  profileAvatar.src = currentAvatar || "";
  welcomeMsg.innerText = `–ü—Ä–∏–≤–µ—Ç, ${currentUser}`;
  loginBtn.style.display = "none";
  logoutBtn.style.display = "block";
}

// ---------- Auth Modal ----------
const authModal = document.getElementById("authModal");
const authInner = document.getElementById("authInner");
const tabLogin = document.getElementById("tabLogin");
const tabRegister = document.getElementById("tabRegister");
const authAvatar = document.getElementById("authAvatar");
const authUsername = document.getElementById("authUsername");
const authPassword = document.getElementById("authPassword");
const authPassword2 = document.getElementById("authPassword2");
const authSubmit = document.getElementById("authSubmit");

loginBtn.onclick = ()=> openAuthModal("login");
authModal.onclick = (e)=>{if(e.target===authModal) closeAuthModal();};

function openAuthModal(mode){
  authModal.classList.add("show");
  if(mode==="login"){showLogin();}
  else{showRegister();}
}

function closeAuthModal(){
  authModal.classList.remove("show");
}

tabLogin.onclick = showLogin;
tabRegister.onclick = showRegister;

function showLogin(){
  tabLogin.classList.add("active");
  tabRegister.classList.remove("active");
  authAvatar.style.display="none";
  authPassword2.style.display="none";
  authSubmit.innerText="–í–æ–π—Ç–∏";
}
function showRegister(){
  tabLogin.classList.remove("active");
  tabRegister.classList.add("active");
  authAvatar.style.display="block";
  authPassword2.style.display="block";
  authSubmit.innerText="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è";
}

authAvatar.onclick = ()=>{const f=document.createElement("input"); f.type="file"; f.accept="image/*"; f.onchange=(e)=>{
  const reader=new FileReader();
  reader.onload=()=>{authAvatar.src=reader.result;}
  reader.readAsDataURL(e.target.files[0]);
}; f.click();}

authSubmit.onclick = ()=>{
  const nick = authUsername.value.trim().replace(/\s+/g,'');
  const pass = authPassword.value;
  const pass2 = authPassword2.value;
  if(tabLogin.classList.contains("active")){
    // login
    if(!nick || !pass) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –∏ –ø–∞—Ä–æ–ª—å!");
    db.ref("users/@"+nick).get().then(snap=>{
      if(!snap.exists()) return alert("–¢–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç!");
      const u = snap.val();
      if(u.password!==pass) return alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
      currentUser = "@"+nick;
      currentAvatar = u.avatar || "";
      profileAvatar.src = currentAvatar;
      localStorage.setItem("currentUser",currentUser);
      localStorage.setItem("currentAvatar",currentAvatar);
      welcomeMsg.innerText = `–ü—Ä–∏–≤–µ—Ç, ${currentUser}`;
      loginBtn.style.display="none";
      logoutBtn.style.display="block";
      closeAuthModal();
      loadReviews();
    });
  } else{
    // register
    if(!nick || !pass || !pass2) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
    if(pass!==pass2) return alert("–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!");
    const avatar = authAvatar.src || "";
    db.ref("users/@"+nick).set({password:pass,avatar:avatar}).then(()=>{
      currentUser = "@"+nick;
      currentAvatar = avatar;
      profileAvatar.src = currentAvatar;
      localStorage.setItem("currentUser",currentUser);
      localStorage.setItem("currentAvatar",currentAvatar);
      welcomeMsg.innerText = `–ü—Ä–∏–≤–µ—Ç, ${currentUser}`;
      loginBtn.style.display="none";
      logoutBtn.style.display="block";
      closeAuthModal();
      loadReviews();
    });
  }
}

logoutBtn.onclick = ()=>{
  currentUser=null;
  currentAvatar="";
  localStorage.removeItem("currentUser");
  localStorage.removeItem("currentAvatar");
  profileAvatar.src="";
  welcomeMsg.innerText="";
  loginBtn.style.display="block";
  logoutBtn.style.display="none";
}

// ---------- TODO: —Å—é–¥–∞ –≤—Å—Ç–∞–≤–ª—è—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∏–∑ 2.6 –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ----------

</script>
</body>
</html>