<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞—Ä–æ—á–Ω–æ–≥–æ –∑–∞ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Inter',sans-serif;background: radial-gradient(circle at 20% 20%, #1b2233 0%, #0b0e14 40%, #05070c 100%);color:#e9edf7;overflow-x:hidden;display:flex;flex-direction:row;}
.menu{display:flex;flex-direction:column;width:60px;background:rgba(30,35,50,0.95);padding:20px 0;position:fixed;height:100vh;z-index:100;border-radius:0 12px 12px 0;box-shadow:2px 0 10px rgba(0,0,0,0.4);}
.menu button{background:none;border:none;color:#aaa;font-size:20px;margin:10px 0;cursor:pointer;display:flex;justify-content:center;align-items:center;transition:0.3s;}
.menu button.active{color:#fff;}
.menu button i{pointer-events:none;}
.page{display:none;padding:20px;padding-left:80px;flex:1;}
.page.active{display:block;}
/* ===== –û—Å–Ω–æ–≤–Ω–æ–π CSS –¥–ª—è —Ñ–æ—Ä–º—ã, –ø—Ä–æ—Ñ–∏–ª—è, —Å–ª–∞–π–¥–µ—Ä–æ–≤, –±–ª–æ–∫–æ–≤ ===== */
.review-container{max-width:1000px;width:100%;margin:auto;padding:25px;background:rgba(18,22,30,0.85);backdrop-filter:blur(20px);border-radius:24px;box-shadow:0 0 60px rgba(0,0,0,0.7);transition: all 0.4s ease;}
.top{display:flex;gap:20px;margin-bottom:25px;flex-wrap:wrap;}
.cover-wrapper{position:relative;cursor:pointer;}
.cover{width:180px;height:180px;border-radius:16px;background:linear-gradient(145deg,#1c2230,#11141b);object-fit:cover;box-shadow:0 0 20px rgba(0,0,0,0.6);transition:all 0.4s ease;}
.meta{flex:1;display:flex;flex-direction:column;gap:10px;}
.meta input{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);padding:10px;border-radius:12px;color:#fff;font-size:14px;}
.award-container{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:5px;}
.award{display:flex;align-items:center;gap:5px;font-size:12px;cursor:pointer;}
.award input{appearance:none;width:14px;height:14px;border-radius:50%;border:1px solid #555;background:#555;cursor:pointer;box-shadow:0 0 2px rgba(0,0,0,0.2);}
.award input:checked{background:#fff;box-shadow:0 0 6px #fff;}
.block{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);border-radius:18px;padding:15px;margin-bottom:12px;box-shadow:0 0 20px rgba(0,0,0,0.4);overflow-x:hidden;transition:all 0.4s ease;}
.block.vibe{background:linear-gradient(90deg, rgba(120,60,255,0.15), rgba(255,60,180,0.1));border:1px solid rgba(160,90,255,0.4);}
.label{display:flex;justify-content:space-between;margin-bottom:8px;font-weight:500;}
input[type=range]{-webkit-appearance:none;width:100%;height:10px;border-radius:5px;background: rgba(255,255,255,0.2);outline:none;box-shadow:0 0 4px rgba(255,255,255,0.3);}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:#fff;box-shadow:0 0 8px #fff;cursor:pointer;}
input[type=range]::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:#fff;box-shadow:0 0 8px #fff;cursor:pointer;}
.result{text-align:right;margin-top:20px;font-size:48px;font-weight:700;}
.result .small{font-size:18px;opacity:0.4;}
textarea{width:100%;margin-top:15px;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.04);color:#fff;min-height:120px;resize:none;overflow:auto;}
.save-btn{margin-top:15px;padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;color:#fff;font-weight:600;cursor:pointer;transition:0.3s;}
.save-btn:hover{background:rgba(255,255,255,0.1);}
.card{background:rgba(18,22,30,0.85);border-radius:16px;padding:10px 12px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.05);display:flex;align-items:center;gap:10px;cursor:pointer;transition:all 0.3s ease;}
.card:hover{transform:scale(1.02);}
.card .rank{width:20px;text-align:center;font-weight:700;color:#fff;}
.card img{width:40px;height:40px;border-radius:6px;object-fit:cover;}
.card .title{font-weight:700;flex:1;font-size:14px;}
.card .score{font-size:16px;font-weight:600;margin-left:8px;}
.card .badges{display:flex;gap:4px;margin-left:5px;}
.card .badges span{background:rgba(100,150,255,0.2);color:#fff;font-size:10px;font-weight:600;padding:2px 5px;border-radius:6px;}
@media(max-width:480px){.cover{width:140px;height:140px;}.review-container{padding:15px;}.block{padding:12px;}.result{font-size:36px;}.card .title{font-size:12px;}.card .score{font-size:14px;}}
</style>
</head>
<body>

<div class="menu">
<button class="active" onclick="openPage('home',event)"><i class="fa-solid fa-house"></i></button>
<button onclick="openPage('review',event)"><i class="fa-solid fa-star"></i></button>
<button onclick="openPage('profile',event)"><i class="fa-solid fa-user"></i></button>
</div>

<div id="home" class="page"></div>

<div id="review" class="page">
<div class="review-container">
<div class="top">
<div class="cover-wrapper" onclick="coverInput.click()">
<img id="coverPreview" class="cover">
<input type="file" id="coverInput" hidden>
</div>
<div class="meta">
<input type="text" id="artist" placeholder="–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å">
<input type="text" id="album" placeholder="–ê–ª—å–±–æ–º">
<div class="award-container">
<label class="award"><input type="checkbox" id="a1"> üñº –û–±–ª–æ–∂–∫–∞ –º–µ—Å—è—Ü–∞</label>
<label class="award"><input type="checkbox" id="a2"> üíø –ê–ª—å–±–æ–º –º–µ—Å—è—Ü–∞</label>
<label class="award"><input type="checkbox" id="a3"> üé¨ –ö–ª–∏–ø –º–µ—Å—è—Ü–∞</label>
<label class="award"><input type="checkbox" id="a4"> üèÜ –ê–ª—å–±–æ–º –≥–æ–¥–∞</label>
</div>
</div>
</div>
<div class="block"><div class="label">–†–∏—Ñ–º—ã / –û–±—Ä–∞–∑—ã <span id="v1">5</span></div><input type="range" min="1" max="10" value="5" id="s1"></div>
<div class="block"><div class="label">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ / –†–∏—Ç–º–∏–∫–∞ <span id="v2">5</span></div><input type="range" min="1" max="10" value="5" id="s2"></div>
<div class="block"><div class="label">–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∏–ª—è <span id="v3">5</span></div><input type="range" min="1" max="10" value="5" id="s3"></div>
<div class="block"><div class="label">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç—å / –•–∞—Ä–∏–∑–º–∞ <span id="v4">5</span></div><input type="range" min="1" max="10" value="5" id="s4"></div>
<div class="block vibe"><div class="label">–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ / –í–∞–π–± <span id="v5">5</span></div><input type="range" min="1" max="10" value="5" id="s5"></div>
<div class="result"><span id="total">28</span><span class="small"> / 90</span></div>
<textarea id="text" placeholder="–¢–µ–∫—Å—Ç —Ä–µ—Ü–µ–Ω–∑–∏–∏"></textarea>
<button class="save-btn" onclick="saveReview()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é</button>
</div>
</div>

<div id="profile" class="page">
<div class="profile-container">
<div style="display:flex;align-items:center;gap:12px;flex-direction:column;">
<div style="display:flex;align-items:center;gap:12px;width:100%;">
<div id="avatarPreview"><span id="avatarPlus">+</span><img id="avatarImg"></div>
<input type="file" id="avatarInput" hidden>
</div>
<button onclick="showLoginModal()">–í–æ–π—Ç–∏</button>
<button onclick="showRegisterModal()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
<button class="logout-btn" onclick="logoutUser()" style="display:none;">–í—ã–π—Ç–∏</button>
<div id="welcomeMsg" style="margin-top:8px;font-size:14px;opacity:0.7;"></div>
</div>
</div>
</div>

<!-- Firebase –∏ —Å–∫—Ä–∏–ø—Ç -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "limteam-46e0f.firebaseapp.com",
  databaseURL: "https://limteam-46e0f-default-rtdb.firebaseio.com",
  projectId: "limteam-46e0f",
  storageBucket: "limteam-46e0f.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

let editingIndex=null;
let currentUser="";

// ---------- –ê–≤–∞—Ç–∞—Ä ----------
const avatarInput=document.getElementById("avatarInput");
avatarInput.addEventListener("change",e=>{
    const file=e.target.files[0]; if(!file) return;
    const reader=new FileReader();
    reader.onload=()=>{const img=document.getElementById("avatarImg"); img.src=reader.result; img.style.display="block"; document.getElementById("avatarPlus").style.display="none"; localStorage.setItem("avatar",reader.result);}
    reader.readAsDataURL(file);
});

// ---------- –°—Ç—Ä–∞–Ω–∏—Ü—ã ----------
function openPage(id,event){
    document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    if(event) document.querySelectorAll(".menu button").forEach(b=>b.classList.remove("active"));
    if(event) event.currentTarget.classList.add("active");
}

// ---------- –°–ª–∞–π–¥–µ—Ä—ã –∏ –æ—Ü–µ–Ω–∫–∞ ----------
const vibeMultipliers={1:1,2:1.0675,3:1.1349,4:1.2024,5:1.2699,6:1.3373,7:1.4048,8:1.4723,9:1.5397,10:1.6072};
for(let i=1;i<=5;i++)document.getElementById("s"+i).addEventListener("input",updateScore);
function updateScore(){
    let base=0;
    for(let i=1;i<=4;i++){let v=parseInt(document.getElementById("s"+i).value); document.getElementById("v"+i).innerText=v; updateSliderProgress(document.getElementById("s"+i)); base+=v;}
    let vibe=parseInt(document.getElementById("s5").value); document.getElementById("v5").innerText=vibe; updateSliderProgress(document.getElementById("s5"));
    document.getElementById("total").innerText=Math.round((base*1.4)*vibeMultipliers[vibe]);
}
function updateSliderProgress(slider){let val=(slider.value-slider.min)/(slider.max-slider.min)*100; slider.style.background=`linear-gradient(to right, rgba(100,150,255,0.6) 0%, rgba(100,150,255,0.6) ${val}%, rgba(255,255,255,0.2) ${val}%, rgba(255,255,255,0.2) 100%)`;}
updateScore();

// ---------- –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Ü–µ–Ω–∑–∏–π ----------
function loadReviews(){
    db.ref("reviews").on("value",snap=>{
        const reviews=snap.val()||{};
        renderTopReviews(Object.entries(reviews));
    });
}
function renderTopReviews(entries){
    const list=document.getElementById("home"); list.innerHTML="";
    if(entries.length===0){list.innerHTML=`<div style="text-align:center;margin-top:50px;color:#888;">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ü–µ–Ω–∑–∏–π. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é!</div>`; return;}
    entries.sort((a,b)=>b[1].total-a[1].total).forEach(([key,r],i)=>{
        const card=document.createElement("div"); card.className="card";
        let badges=r.awards.map((a,j)=>a?<span>${["üñº –û–±–ª–æ–∂–∫–∞ –º–µ—Å—è—Ü–∞","üíø –ê–ª—å–±–æ–º –º–µ—Å—è—Ü–∞","üé¨ –ö–ª–∏–ø –º–µ—Å—è—Ü–∞","üèÜ –ê–ª—å–±–æ–º –≥–æ–¥–∞"][j]}</span>:"").join("");
        if(!badges) badges='<span>–ù–µ—Ç –Ω–æ–º–∏–Ω–∞—Ü–∏–π</span>';
        card.dataset.key=key;
        card.innerHTML=`<div class="rank">${i+1}</div>${r.cover?`<img src="${r.cover}">`:`<div style="width:40px;height:40px;border-radius:6px;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;color:#aaa;font-size:12px;">?</div>`}<span class="title">${r.artist} ‚Äî ${r.album}</span><div class="badges">${badges}</div><span class="score">${r.total}</span>`;
        card.onclick=()=>showPreview(key,r);
        list.appendChild(card);
    });
}

// ---------- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ----------
window.addEventListener("load",()=>{
    const savedName=localStorage.getItem("nickname");
    const savedAvatar=localStorage.getItem("avatar");
    if(savedName){currentUser=savedName; document.getElementById("welcomeMsg").innerText=`–ü—Ä–∏–≤–µ—Ç, ${savedName}`; document.querySelector(".logout-btn").style.display="block";}
    if(savedAvatar){document.getElementById("avatarImg").src=savedAvatar; document.getElementById("avatarImg").style.display="block"; document.getElementById("avatarPlus").style.display="none";}
    loadReviews();
});
openPage('home');
</script>
</body>
</html>